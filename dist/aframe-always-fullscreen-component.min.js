!function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var i=window.innerWidth;AFRAME.registerComponent("always-fullscreen",{schema:{platform:{default:"mobile",oneOf:["mobile","desktop","all"]},debug:{default:!1}},init:function(){if(this.mask=this.mask.bind(this),this.initialize=this.initialize.bind(this),this.updateMasks=this.updateMasks.bind(this),this.resizeHandler=this.resizeHandler.bind(this),this.orientationChangeHandler=this.orientationChangeHandler.bind(this),this.orientationChangeHelper=this.orientationChangeHelper.bind(this),this.cancel=this.cancel.bind(this),!platform)throw new Error("Platform dependency is not available")},update:function(e){this.el.sceneEl.hasLoaded?this.initialize():this.el.sceneEl.addEventListener("loaded",this.initialize)},initialize:function(){var e=document.querySelector("#fullscreenbutton");e&&e.parentNode.removeChild(e),this.removeEventListeners(),("iOS"==platform.os.family&&parseInt(platform.os.version,10)>8||platform.ua.indexOf("like Mac OS X")!=-1)&&("all"===this.data.platform||"mobile"===this.data.platform&&this.el.sceneEl.isMobile)?(this.makeTreadmill(),this.makeMask(),window.addEventListener("resize",this.resizeHandler),window.addEventListener("orientationchange",this.orientationChangeHandler)):("all"===this.data.platform||"mobile"===this.data.platform&&this.el.sceneEl.isMobile||"desktop"===this.data.platform&&!this.el.sceneEl.isMobile)&&(this.makeFullscreenMask(),document.addEventListener("webkitfullscreenchange",this.updateMasks),document.addEventListener("mozfullscreenchange",this.updateMasks),document.addEventListener("msfullscreenchange",this.updateMasks),document.addEventListener("webkitfullscreenchange",this.updateMasks)),this.updateMasks()},removeEventListeners:function(){window.removeEventListener("resize",this.resizeHandler),window.removeEventListener("orientationchange",this.orientationChangeHandler),document.removeEventListener("webkitfullscreenchange",this.updateMasks),document.removeEventListener("mozfullscreenchange",this.updateMasks),document.removeEventListener("msfullscreenchange",this.updateMasks),document.removeEventListener("webkitfullscreenchange",this.updateMasks)},remove:function(){var e=document.querySelector("#mask");e&&e.parentNode.removeChild(e);var t=document.querySelector("#treadmill");t&&t.parentNode.removeChild(t);var i=document.querySelector("#fullscreenmask");i&&i.parentNode.removeChild(i);var n=document.querySelector("#fullscreenbutton");n&&n.parentNode.removeChild(i),this.removeEventListeners(),window.scrollTo(0,0),this.el.style.height="100%",this.el.sceneEl.resize()},makeMask:function(){var e=document.querySelector("#mask");e||(e=document.createElement("div"),e.id="mask",document.body.appendChild(e)),e.style.position="fixed",e.style.zIndex=9999999999,e.style.top=0,e.style.left=0,e.style.display="none",e.style.backgroundColor="#663399",this.appendCancelButton(e)},makeTreadmill:function(){var e=document.querySelector("#treadmill");e||(e=document.createElement("div"),e.id="treadmill",document.body.appendChild(e)),e.style.visibility="hidden",e.style.position="relative",e.style.zIndex=10,e.style.left=0,e.style.display="block",e.style.width="1px",e.style.height="9999999999999999px"},makeFullscreenMask:function(){var e=document.querySelector("#fullscreenmask");document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||(e||(e=document.createElement("div"),e.id="fullscreenmask",document.body.appendChild(e),e.addEventListener("click",this.enterFullScreen)),e.style.position="fixed",e.style.zIndex=9999999999,e.style.top=0,e.style.left=0,e.style.display="block",e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px",e.style.backgroundColor="#663399",this.appendCancelButton(e))},makeFullscreenButton:function(){var e=document.querySelector("#fullscreenbutton");if(!e){e=document.createElement("button"),e.id="fullscreenbutton";var t=document.querySelector("div.a-enter-vr");if(!t){var t=document.createElement("div");t.className="a-enter-vr"}t.appendChild(e),e.addEventListener("click",this.initialize)}var i=5,n="10vh",o="10vh",s=document.querySelector("button.a-enter-vr-button");s&&(i+=s.offsetWidth,o=s.offsetWidth,n=s.offsetHeight),e.style.position="absolute",e.style.zIndex=9999,e.style.bottom=0,e.style.right=i+"px",e.style.display="block",e.style.width=o,e.style.height=n},mask:function(){var e=document.querySelector("#mask"),t=document.querySelector("#treadmill");this.isMinimalView()?(e&&"none"!=e.style.display&&(e.style.display="none"),t&&(t.style.display="none"),window.scrollTo(0,0),this.el.style.height=window.innerHeight,this.el.sceneEl.resize()):e?(e.style.display="block",e.style.width=window.innerWidth+"px",e.style.height=2*window.innerHeight*this.changeFactor+"px",t&&(t.style.display="block")):this.makeFullscreenButton()},fullscreenMask:function(){var e=document.querySelector("#fullscreenmask");document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?e&&e.parentNode.removeChild(e):e?(e.style.display="block",e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px"):this.makeFullscreenButton()},isMinimalView:function(){var e=window.innerHeight,t=Math.ceil(document.body.clientWidth/window.innerWidth*10)/10;this.data.debug&&(console.log("Initial Client-Width: "+i),console.log("window.innerHeight: "+e),console.log("Zoom: "+t),console.log("Change-Factor: "+this.changeFactor),console.log("Minimal-ViewHeight: "+this.getMinimalViewHeight()),console.log("Minimal-ViewHeight AfterFactor: "+Math.round(this.getMinimalViewHeight()/this.changeFactor)));var n=e*t,o=Math.round(this.getMinimalViewHeight()/this.changeFactor);return o="portrait"===this.getOrientation()?o:o-20,!(n<o)},getMinimalViewHeight:function(){for(var e=this.getOrientation(),t=[[1619,552,320,568,"iPhone 5, 5S"],[1640,551,375,667,"iPhone 6, 6S, 7"],[1648,551,414,736,"iPhone 6, 6S, 7 Plus"]],i=null,n=0;n<t.length;n++)window.screen.width==t[n][2]&&window.screen.height==t[n][3]&&(i=n);if(!i)throw new Error("Couldn't detect iOS Device!");return"portrait"===e?t[i][0]:t[i][1]},enterFullScreen:function(){var e=window.document,t=e.documentElement,i=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement||i.call(t)},getOrientation:function(){return 0===window.orientation||180===window.orientation?"portrait":"landscape"},updateMasks:function(){this.changeFactor=i/document.body.clientWidth,("iOS"==platform.os.family&&parseInt(platform.os.version,10)>8||platform.ua.indexOf("like Mac OS X")!=-1)&&("all"===this.data.platform||"mobile"===this.data.platform&&this.el.sceneEl.isMobile)?this.mask():("all"===this.data.platform||"mobile"===this.data.platform&&this.el.sceneEl.isMobile||"desktop"===this.data.platform&&!this.el.sceneEl.isMobile)&&this.fullscreenMask()},resizeHandler:function(){this.resizeTimeout&&window.clearTimeout(this.resizeTimeout),this.resizeTimeout=window.setTimeout(this.updateMasks,50),this.data.debug&&console.log("Resize Event")},orientationChangeHandler:function(){this.orientationChangeHelper(),this.resizeTimeout&&window.clearTimeout(this.resizeTimeout),this.orientationTimeout&&window.clearTimeout(this.orientationTimeout),this.orientationTimeout=window.setTimeout(this.updateMasks,500)},orientationChangeHelper:function(){this.lastInnerWidth&&this.lastInnerHeight&&window.innerWidth===this.lastInnerWidth&&window.innerHeight===this.lastInnerHeight?(this.noChangeCount=this.noChangeCount?this.noChangeCount+1:1,this.noChangeCount>=50?(this.orientationTimeout&&window.clearTimeout(this.orientationTimeout),this.orientationChangeHelperTimout&&window.clearTimeout(this.orientationChangeHelperTimout),this.data.debug&&console.log("Updating Masks after Orientation-Change due to Count."),this.noChangeCount=1,this.updateMasks()):(this.orientationChangeHelperTimout&&window.clearTimeout(this.orientationChangeHelperTimout),this.orientationChangeHelperTimout=window.setTimeout(this.orientationChangeHelper,1))):(this.orientationChangeHelperTimout&&window.clearTimeout(this.orientationChangeHelperTimout),this.orientationChangeHelperTimout=window.setTimeout(this.orientationChangeHelper,10)),this.lastInnerWidth=window.innerWidth,this.lastInnerHeight=window.innerHeight},cancel:function(e){"function"==typeof e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.remove(),this.makeFullscreenButton()},appendCancelButton:function(e){var t=document.createElement("button");t.className="alwaysfullscreencancelbutton",e.appendChild(t),t.addEventListener("click",this.cancel)}})}]);